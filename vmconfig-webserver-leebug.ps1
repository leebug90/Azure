# Allow ICMP
netsh advfirewall firewall add rule name="Allow ICMPv4" protocol=icmpv4:8,any dir=in action=allow
netsh advfirewall firewall add rule name="Allow ICMPv6" protocol=icmpv6:8,any dir=in action=allow

# Install IIS with ASP.Net support
Install-WindowsFeature -name Web-Server, Web-Asp-Net45 -IncludeManagementTools

# Create a default file containing WAN IP, ipconfig output, and a dump of request headers
$HTML = "<pre>" + $ENV:COMPUTERNAME + "<br/>"
$HTML += "WAN IP: $(irm ifconfig.me) <br/><hr/>"
$HTML += "Request headers: <br/>"
$HTML += '<%= Request.Headers.ToString().Replace("&","<br/>") %></pre>'
$HTML > C:\inetpub\wwwroot\default.aspx

# Install Certificate - leebug.biz 
# Updated at 12 June 2025
mkdir c:\Temp1
Add-Content -Value "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" -Path C:\temp1\pfx-encoded-bytes.txt
certutil -decode c:\temp1\pfx-encoded-bytes.txt c:\temp1\backend.pfx
certutil -f -p poshacme -importpfx c:\temp1\backend.pfx

# Remove default iisstart.htm file
Remove-Item "C:\inetpub\wwwroot\iisstart.htm"

# Configure IIS HTTPS binding using previously imported self signed certificate
$Cert = Get-ChildItem Cert:\LocalMachine\My\ | ? Subject -eq "CN=*.leebug.biz"
New-WebBinding -Name "Default Web Site" -Protocol https -Port 443
(Get-WebBinding -Name "Default Web Site" -Protocol https -Port 443).AddSslCertificate($Cert.Thumbprint, "my")

# Remove http binding
Remove-WebBinding -Protocol http -Port 80

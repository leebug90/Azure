# Allow ICMP
netsh advfirewall firewall add rule name="Allow ICMPv4" protocol=icmpv4:8,any dir=in action=allow
netsh advfirewall firewall add rule name="Allow ICMPv6" protocol=icmpv6:8,any dir=in action=allow

# Install IIS with ASP.Net support
Install-WindowsFeature -name Web-Server, Web-Asp-Net45 -IncludeManagementTools

# Create a default file containing WAN IP, ipconfig output, and a dump of request headers
$HTML = "<pre>" + $ENV:COMPUTERNAME + "<br/>"
$HTML += "WAN IP: $(irm ifconfig.me) <br/><hr/>"
$HTML += "Request headers: <br/>"
$HTML += '<%= Request.Headers.ToString().Replace("&","<br/>") %></pre>'
$HTML > C:\inetpub\wwwroot\default.aspx

# Install Certificate - leebug.biz
mkdir c:\Temp1
Add-Content -Value "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"  -Path C:\temp1\pfx-encoded-bytes.txt
certutil -decode c:\temp1\pfx-encoded-bytes.txt c:\temp1\backend.pfx
certutil -f -p poshacme -importpfx c:\temp1\backend.pfx

# Remove default iisstart.htm file
Remove-Item "C:\inetpub\wwwroot\iisstart.htm"

# Configure IIS HTTPS binding using previously imported self signed certificate
$Cert = Get-ChildItem Cert:\LocalMachine\My\ | ? Subject -eq "CN=*.leebug.biz"
New-WebBinding -Name "Default Web Site" -Protocol https -Port 443
(Get-WebBinding -Name "Default Web Site" -Protocol https -Port 443).AddSslCertificate($Cert.Thumbprint, "my")

# Remove http binding
Remove-WebBinding -Protocol http -Port 80
